version: '3.7'
services:
  easy-log-server-admin01:
    image: ${image}
    container_name: easy-log-server-admin01
    environment:
      - SPRING_PROFILES_ACTIVE=dev
      - HEAP_SIZE=${heap_size}
      - easy-log.admin.enable=true
      - easy-log.compute.enable=false
      - easy-log.collector.enable=false
    volumes:
      - easy-log-server-admin01:/app
    ports:
      - "2203:1203"
      - "2204:1883"
      - "2205:8083"
    networks:
      - easy-log
    healthcheck:
      test: [ "CMD", "curl", "-f", "http://localhost:1203/monitor/health" ]
      start_period: 3s
      retries: 3

  easy-log-server-compute01:
    image: ${image}
    container_name: easy-log-server-compute01
    environment:
      - SPRING_PROFILES_ACTIVE=dev
      - HEAP_SIZE=${heap_size}
      - easy-log.admin.enable=false
      - easy-log.compute.enable=true
      - easy-log.collector.enable=false
      - consumer-global-orders=5,6,7,8
    volumes:
      - easy-log-server-compute01:/app
    networks:
      - easy-log
    healthcheck:
      test: [ "CMD", "curl", "-f", "http://localhost:1203/monitor/health" ]
      start_period: 3s
      retries: 3

  easy-log-server-collector01:
    image: ${image}
    container_name: easy-log-server-collector01
    environment:
      - SPRING_PROFILES_ACTIVE=dev
      - HEAP_SIZE=${heap_size}
      - easy-log.admin.enable=false
      - easy-log.compute.enable=false
      - easy-log.collector.enable=true
      - consumer-global-orders=5,6,7,8
    volumes:
      - easy-log-server-collector01:/app
    networks:
      - easy-log
    healthcheck:
      test: [ "CMD", "curl", "-f", "http://localhost:1203/monitor/health" ]
      start_period: 3s
      retries: 3

volumes:
  easy-log-server-admin01:
    driver: local
  easy-log-server-compute01:
    driver: local
  easy-log-server-collector01:
    driver: local

networks:
  easy-log:
    driver: bridge
    ipam:
      config:
        - subnet: 172.30.0.0/16
          gateway: 172.30.0.1